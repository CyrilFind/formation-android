
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>TP 1 - RecyclerView</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="tp1"
                  title="TP 1 - RecyclerView"
                  environment="web"
                  feedback-link="">
    
      <google-codelab-step label="Cr√©er un projet" duration="0">
        <p>Vous allez cr√©er un unique projet &#34;fil rouge&#34; que vous mettrez √† jour au fur √† mesure des TPs:</p>
<ul>
<li>Utilisez l&#39;IDE pour cr√©er un projet <code>Empty Activity</code></li>
<li>Donnez lui un nom personnalis√© comme <code>ToDoNicolasAlexandre</code> (‚ö†Ô∏è pas <code>TP1</code> SVP ‚ö†Ô∏è)</li>
<li>Choisissez un package name (ex: <code>com.nicoalex.todo</code>)</li>
<li>Language <code>Kotlin</code></li>
<li>Minimum API Level: API 23, Android 6.0 (Marshmallow)</li>
<li>Initialisez un projet git et faites un commit initial</li>
<li>Committez r√©guli√®rement: √† chaque fois que vous avez quelque chose qui compile et qui fonctionne.</li>
<li>Faites au minimum un commit √† la fin de chaque TP (et taggez ce commit avec le num√©ro du TP !)</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Ajout de D√©pendances" duration="0">
        <p>Dans le fichier <code>app/build.gradle</code>, ajouter les libs suivante dans <code>dependencies { ... }</code>:</p>
<pre><code language="language-groovy" class="language-groovy">implementation &#34;androidx.recyclerview:recyclerview:1.2.0&#34;
implementation &#39;androidx.fragment:fragment-ktx:1.3.2&#39;
implementation &#39;androidx.activity:activity-ktx:1.2.2&#39;
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Gestion des fichiers" duration="0">
        <p>Les fichiers source Java ou Kotlin sont rang√©s en &#34;packages&#34; (not√© en haut de chaque classe: <code>package com.nicoalex.todo.nomdupackage</code>) qui sont aussi r√©pliqu√©s en tant que dossiers dans le file system</p>
<p>Dans le volet &#34;Projet&#34; (√† gauche d&#39;Android Studio), vous pouvez choisir diverses visualisations de vos fichers: la plus adapt√©e est &#34;Android&#34;, mais il peut parfois √™tre pratique de passer en &#34;Project Files&#34; par ex</p>
<p>Ouvrez l&#39;arborescence de fichiers jusqu&#39;√† la racine de vos fichiers source et cr√©ez un package <code>tasklist</code> √† l&#39;int√©rieur:</p>
<p><code>app > java > com.nicoalex.todo > clic droit > New > package > "tasklist"</code></p>
<p>Vous y mettrez tous les fichiers source (Kotlin) concernant la liste de t√¢ches</p>


      </google-codelab-step>
    
      <google-codelab-step label="TaskListFragment" duration="0">
        <ul>
<li>Cr√©ez y un fichier kotlin <code>TaskListFragment.kt</code> qui contiendra la classe <code>TaskListFragment</code>:</li>
</ul>
<pre><code language="language-kotlin" class="language-kotlin">class TaskListFragment : Fragment() {}
</code></pre>
<ul>
<li>Cr√©er le layout associ√© <code>fragment_task_list.xml</code></li>
<li>Dans <code>TaskListFragment</code>, overrider la m√©thode <code>onCreateView(...)</code>: commencez √† taper <code>onCrea...</code> et utilisez l&#39;auto-completion de l&#39;IDE pour vous aider (vous pouvez supprimer la ligne <code>super.onCreateView(...)</code>)</li>
<li>Cette m√©thode vous demande de <em>retourner</em> la <code>rootView</code> √† afficher: cr√©ez la √† l&#39;aide de votre nouveau layout comme ceci:</li>
</ul>
<pre><code language="language-kotlin" class="language-kotlin">val rootView = inflater.inflate(R.layout.fragment_task_list, container, false)
</code></pre>
<p>‚ö†Ô∏è Si vous executez du code <em>avant</em> cette ligne <code>inflate</code>, il va crasher ou ne rien faire car votre vue n&#39;existera pas encore</p>
<ul>
<li>Remplacez la balise <code><TextView.../></code> par une balise <code><FragmentContainerView.../></code> dans le layout de votre activit√© principale (√† adapter √† votre projet):</li>
</ul>
<pre><code language="language-xml" class="language-xml"> &lt;androidx.fragment.app.FragmentContainerView
    android:name=&#34;com.example.nicoalex.TaskListFragment&#34;
    android:id=&#34;@+id/fragment_tasklist&#34;
    android:layout_width=&#34;match_parent&#34;
    android:layout_height=&#34;match_parent&#34;
    /&gt;
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="La liste des t√¢ches" duration="0">
        <ul>
<li>Pour commencer, la liste des t√¢ches sera simplement une liste de <code>String</code>:</li>
</ul>
<pre><code language="language-kotlin" class="language-kotlin">private val taskList = listOf(&#34;Task 1&#34;, &#34;Task 2&#34;, &#34;Task 3&#34;)
</code></pre>
<ul>
<li>Dans le layout associ√© √† <code>TaskListFragment</code>, placez une balise <code><androidx.recyclerview.widget.RecyclerView...></code>:</li>
<li>Cr√©er une nouvelle classe <code>TaskListAdapter</code>:</li>
</ul>
<pre><code language="language-kotlin" class="language-kotlin">class TaskListAdapter(private val taskList: List&lt;String&gt;) : RecyclerView.Adapter&lt;TaskListAdapter.TaskViewHolder&gt;() {}
</code></pre>
<ul>
<li>√Ä l&#39;int√©rieur de <code>TaskListAdapter</code>, cr√©er la classe <code>TaskViewHolder</code>:</li>
</ul>
<pre><code language="language-kotlin" class="language-kotlin">inner class TaskViewHolder(itemView: View) : RecyclerView.ViewHolder(itemView) {
  fun bind(taskTitle: String) {
    
  }
}
</code></pre>
<ul>
<li>Cr√©er le layout <code>item_task.xml</code> correspondant √† une cellule (<code>TaskViewHolder</code>)</li>
</ul>
<pre><code language="language-xml" class="language-xml">&lt;LinearLayout
  xmlns:android=&#34;http://schemas.android.com/apk/res/android&#34;
  android:orientation=&#34;vertical&#34;
  android:layout_width=&#34;match_parent&#34;
  android:layout_height=&#34;wrap_content&#34;&gt;

  &lt;TextView
      android:id=&#34;@+id/task_title&#34;
      android:background=&#34;@android:color/holo_blue_bright&#34;
      android:layout_width=&#34;match_parent&#34;
      android:layout_height=&#34;wrap_content&#34; /&gt;
&lt;/LinearLayout&gt;
</code></pre>
<ul>
<li>Dans <code>TaskListFragment</code>, overridez <code>onViewCreated</code> pour y r√©cup√©rer la <code>RecyclerView</code> du layout en utilisant un <code>findViewbyId</code>:</li>
</ul>
<pre><code language="language-kotlin" class="language-kotlin">    // Pour une [RecyclerView] ayant l&#39;id &#34;recycler_view&#34;:
    val recyclerView = view.findViewById&lt;RecyclerView&gt;(R.id.recycler_view)
    recyclerView.layoutManager = ...
</code></pre>
<ul>
<li>Donnez lui un <code>layoutManager</code>: <code>LinearLayoutManager(activity)</code></li>
<li>Donnez lui un <code>adapter</code>: <code>TaskListAdapter(taskList)</code> (ne marche pas pour l&#39;instant)</li>
</ul>
<p><strong>Rappel</strong>: l&#39;Adapter g√®re le recyclage des cellules (<code>ViewHolder</code>): il en <code>inflate</code> juste assez pour remplir l&#39;√©cran (co√ªteux) puis change seulement les donn√©es quand on scroll (peu co√ªteux)</p>


      </google-codelab-step>
    
      <google-codelab-step label="Impl√©mentation du RecyclerViewAdapter" duration="0">
        <p>Dans le <code>TaskListAdapter</code>, impl√©menter toutes les m√©thodes requises:</p>
<p><strong>Astuce</strong>: Pr√©-remplissez votre adapter en cliquant sur le nom de votre classe (qui doit √™tre pour l&#39;instant soulign√©e en rouge) et cliquez sur l&#39;ampoule jaune ou tapez <code>Alt</code> + <code>ENTER</code> (sinon, <code>CTRL</code> + <code>O</code> n&#39;importe o√π dans la classe)</p>
<ul>
<li><code>getItemCount</code> doit renvoyer la taille de la liste de t√¢che √† afficher</li>
<li><code>onCreateViewHolder</code> doit retourner un nouveau <code>TaskViewHolder</code> en g√©n√©rant un <code>itemView</code>, √† partir du layout <code>item_task.xml</code>:</li>
</ul>
<pre><code language="language-kotlin" class="language-kotlin">val itemView = LayoutInflater.from(parent.context).inflate(R.layout.item_task, parent, false)
</code></pre>
<ul>
<li><code>onBindViewHolder</code> doit ins√®rer la donn√©e dans la cellule (<code>TaskViewHolder</code>) en fonction de sa <code>position</code> dans la liste en utilisant la m√©thode <code>bind()</code> que vous avez cr√©√©e dans <code>TaskViewHolder</code> (elle ne fait rien pour l&#39;instant)</li>
<li>Impl√©mentez maintenant <code>bind()</code> qui doit r√©cup√©rer une r√©f√©rence √† la <code>TextView</code> dans <code>item_task.xml</code> et y ins√©rer le texte r√©cup√©r√© en argument</li>
<li>Lancez l&#39;app: vous devez voir 3 t√¢ches s&#39;afficher üëè</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Ajout de la data class Task" duration="0">
        <ul>
<li>Dans un nouveau fichier, cr√©er une <code>data class Task</code> avec 3 attributs: un id, un titre et une description</li>
<li>Ajouter une valeur par d√©faut √† la description.</li>
<li>Dans le <code>TaskListFragment</code>, remplacer la liste <code>taskList</code> par</li>
</ul>
<pre><code language="language-kotlin" class="language-kotlin">private val taskList = listOf(
   Task(id = &#34;id_1&#34;, title = &#34;Task 1&#34;, description = &#34;description 1&#34;),
   Task(id = &#34;id_2&#34;, title = &#34;Task 2&#34;),
   Task(id = &#34;id_3&#34;, title = &#34;Task 3&#34;)
)
</code></pre>
<ul>
<li>Corriger votre code en cons√©quence afin qu&#39;il compile de nouveau</li>
<li>Enfin afficher la description en dessous du titre</li>
<li>Admirez avec fiert√© le travail accompli ü§©</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Ajout de t√¢che rapide" duration="0">
        <ul>
<li>Changez la root view de <code>fragment_task_list.xml</code> en ConstraintLayout en faisant un clic droit dessus en mode design</li>
<li>Ouvrez le volet &#34;Resource Manager&#34; √† gauche, cliquez sur le &#34;+&#34; en haut √† gauche puis &#34;Vector Asset&#34; puis double cliquez sur le clipart du logo android et trouvez une icone &#34;+&#34; (en tapant &#34;add&#34;) puis &#34;finish&#34; pour ajouter une icone √† vos resource</li>
<li>Ajouter un Floating Action Button (FAB) en bas √† droite de ce layout et utilisez l&#39;icone cr√©√©e</li>
<li>Par d√©faut l&#39;ic√¥ne est noire mais vous pourrez utiliser l&#39;attribut <code>android:tint</code> du bouton pour la rendre blanche (tapez &#34;white&#34; et laissez l&#39;IDE compl√©ter)</li>
<li>Donnez des contraintes en bas et √† droite de ce bouton (vous pouvez utiliser le mode &#34;Aimant&#34; qui essaye de donner les bonnes contraintes automagiquement)</li>
<li>Transformer votre liste de t√¢ches <code>taskList</code> en <code>mutableListOf(...)</code> afin de pouvoir y ajouter ou supprimer des √©l√©ments</li>
<li>Utilisez <code>.setOnClickListener {}</code> sur le FAB pour ajouter une t√¢che √† votre liste:</li>
</ul>
<pre><code language="language-kotlin" class="language-kotlin">// Instanciation d&#39;un objet task avec des donn√©es pr√©remplies:
Task(id = UUID.randomUUID().toString(), title = &#34;Task ${taskList.size + 1}&#34;)
</code></pre>
<ul>
<li>Dans cette lambda, <strong>notifier l&#39;adapteur</strong> (aidez vous des suggestions de l&#39;IDE) pour que votre modification s&#39;affiche</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="ListAdapter" duration="0">
        <p>Am√©liorer l&#39;impl√©mentation de <code>TasksListAdapter</code> en h√©ritant de <code>ListAdapter</code> au lieu de <code>RecyclerView.Adapter</code> (cf [slides](./3\ -\ RecyclerView.md))</p>
<p>‚ö†Ô∏è Comme on utilise une <code>MutableList</code> (ce qu&#39;on ne fait pas en g√©n√©ral), il faut envoyer une nouvelle instance √† chaque fois pour que le <code>ListAdapter</code> puisse les comparer, utilisez <code>toList()</code> pour cela: <code>adapter.submitList(taskList.toList())</code></p>


      </google-codelab-step>
    
      <google-codelab-step label="ViewBinding" duration="0">
        <p>Utiliser le <a href="https://developer.android.com/topic/libraries/view-binding" target="_blank"><code>ViewBinding</code></a> pour <code>inflate</code> les diff√©rents layouts et √©viter les <code>findViewByIds</code> (cf <a href="./1%20-%20Introduction.pdf" target="_blank">slides</a>)</p>


      </google-codelab-step>
    
      <google-codelab-step label="Interface et d√©l√©gation" duration="0">
        <p>Une fa√ßon plus classique de g√©rer les clicks d&#39;un item est de d√©finir une interface que l&#39;on impl√©mentera dans l&#39;Activity/Fragment. Mettez √† jour votre code pour utiliser cette m√©thode:</p>
<pre><code language="language-kotlin" class="language-kotlin">interface TaskListListener {
  fun onClickDelete(task: Task)
}

class TaskListAdapter(val listener: TaskListListener) : ... {
  // use: listener.onClickDelete(task)
}

class TaskListFragment : Fragment {
  val adapterListener = object : TaskListListener {
    override onClickDelete(task: Task) {...}
  }
  val adapter = TaskListAdapter(adapterListener)
}
</code></pre>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
