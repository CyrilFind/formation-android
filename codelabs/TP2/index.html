
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>TP 2 - Actions &amp; Intents</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="TP2"
                  title="TP 2 - Actions &amp; Intents"
                  environment="web"
                  feedback-link="">
    
      <google-codelab-step label="Suppression d&#39;une tache" duration="0">
        <p>Dans le layout de votre ViewHolder, ajouter un <code>ImageButton</code> qui servira √† supprimer la t√¢che associ√©e. Vous pouvez utiliser par exemple l&#39;icone <code>@android:drawable/ic_menu_delete</code></p>
<p><strong>Rappel:</strong> Une <a href="https://kotlinlang.org/docs/reference/lambdas.html" target="_blank">lambda</a> est un type de variable qui contient un bloc de code pouvant prendre des arguments et retourner un r√©sultat, c&#39;est donc une fonction que l&#39;on utilise comme une variable !</p>
<p>Aidez vous des lignes de code plus bas pour r√©aliser un &#34;Click Listener&#34; √† l&#39;aide d&#39;une lambda en suivant ces √©tapes:</p>
<ul>
<li>Dans l&#39;adapter, ajouter une propri√©t√© lambda <code>onClickDelete</code> qui prends en arguments une <code>Task</code> et ne renvoie rien: <code>(Task) -> Unit</code> et l&#39;initier √† <code>null</code> (elle ne fait rien par d√©faut)</li>
<li>Utilisez cette lambda dans le <code>onClickListener</code> du bouton supprimer</li>
<li>Dans le fragment, acc√©der √† <code>onClickDelete</code> depuis l&#39;adapter et impl√©mentez l√†: donnez lui comme valeur une lambda qui va supprimer la tache pass√©e en argument de la liste</li>
</ul>
<pre><code language="language-kotlin" class="language-kotlin">// D√©claration de la variable lambda dans l&#39;adapter:
var onClickDelete: ((Task) -&gt; Unit)? = null

// &#34;impl√©mentation&#34; de la lambda dans le fragment:
adapter.onClickDelete = { task -&gt;
    // Supprimer la t√¢che
}

// Utilisation de la lambda dans le ViewHolder:
onClickDelete?.invoke(task)
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Ajout de t√¢che complet" duration="0">
        <ul>
<li>Cr√©er un package <code>task</code></li>
<li>Cr√©ez y la nouvelle <code>TaskActivity</code>, n&#39;oubliez pas de la d√©clarer dans le manifest</li>
<li>Cr√©er un layout contenant 2 <code>EditText</code>, pour le titre et la description et un bouton pour valider</li>
<li>Changer l&#39;action du FAB pour qu&#39;il ouvre cette activit√© avec un <code>Intent</code>, en attendant un resultat:</li>
</ul>
<pre><code language="language-kotlin" class="language-kotlin">val intent = Intent(activity, TaskActivity::class.java)
startActivityForResult(intent, ADD_TASK_REQUEST_ID)
</code></pre>
<ul>
<li>Dans le <code>onCreate</code> de la nouvelle activit√©, r√©cup√©rer le bouton de validation puis setter son <code>onClickListener</code> pour qu&#39;il cr√©e une t√¢che:</li>
</ul>
<pre><code language="language-kotlin" class="language-kotlin">// Instanciation d&#39;un nouvel objet [Task]
val newTask = Task(id = UUID.randomUUID().toString(), title = &#34;New Task !&#34;)
</code></pre>
<ul>
<li>Faites h√©riter <code>Task</code> de <code>Serializable</code> pour pouvoir passer des objets <code>Task</code> dans les <code>intent</code></li>
<li>Passez <code>newTask</code> dans l&#39;intent avec <code>putExtra(...)</code></li>
<li>utlisez <code>setResult(...)</code> et <code>finish()</code> pour retourner √† l&#39;activit√© principale</li>
<li>Dans celle ci, overrider <code>onActivityResult</code> dans le <code>TaskFragment</code> pour r√©cup√©rer cette task et l&#39;ajouter √† la liste</li>
</ul>
<pre><code language="language-kotlin" class="language-kotlin">val task = data?.getSerializableExtra(TaskActivity.TASK_KEY) as? Task
</code></pre>
<ul>
<li>Faites en sorte que la nouvelle tache s&#39;affiche au retour sur l&#39;activit√© principale</li>
<li>Maintenant, r√©cup√©rez les valeurs entr√©es dans les <code>EditText</code> pour les donner √† la cr√©ation de votre t√¢che (vous devrez faire un <code>toString()</code>)</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="√âdition d&#39;une t√¢che" duration="0">
        <ul>
<li>Ajouter une bouton permettant d&#39;√©diter chaque t√¢che en ouvrant l&#39;activit√© <code>TaskActivity</code> pr√©-remplie avec les informations de la t√¢che</li>
<li>Pour transmettre des infos d&#39;une activit√© √† l&#39;autre, vous pouvez utiliser la m√©thode <code>putExtra</code> depuis une instance d&#39;<code>intent</code></li>
<li>Inspirez vous de l&#39;impl√©mentation du bouton supprimer et du bouton ajouter</li>
<li>Vous pouvez ensuite r√©cup√©rer dans le <code>onCreate</code> de l&#39;activit√© les infos que vous avez pass√©es:<ul>
<li>r√©cup√©rez la t√¢che pass√©e avec un <code>getSerializableExtra</code> et un <code>as? Task</code></li>
<li>Vous pourrez tirer parti de la variable <code>Task?</code> (nullable) pour r√©utiliser le code de la cr√©ation et remplir les <code>EditText</code></li>
<li>De m√™me vous pourrez utiliser l&#39;op√©rateur <code>?:</code> pour setter l&#39;<code>id</code> en utilisant la m√©thode <code>UUID...</code> pr√©c√©dente par d√©faut</li>
<li>Utilisez <code>setText</code> pour pr√©remplir les <code>EditText</code></li>
</ul>
</li>
<li>Au retour dans <code>onActivityResult</code>, vous pouvez utiliser <code>indexOfFirst { /* une condition */ }</code> sur votre liste pour trouver la tache concern√©e et la remplacer dans la liste, et s&#39;il n&#39;y  a pas, c&#39;est qu&#39;il s&#39;agit d&#39;un ajout</li>
<li>V√©rifier que les infos √©dit√©es s&#39;affichent bien √† notre retour sur l&#39;activit√© principale.</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Nouvelle API ActivityResult" duration="0">
        <p>Changez votre code pour utiliser cette nouvelle m√©thode, par ex avec <code>StartActivityForResult()</code>:</p>
<pre><code language="language-kotlin" class="language-kotlin">val startForResult = registerForActivityResult(StartActivityForResult()) {...}
// ...
startForResult.launch(intent)
</code></pre>
<p>Mais vous pouvez aussi d√©finir un <a href="https://developer.android.com/training/basics/intents/result#custom" target="_blank">contrat sp√©cifique</a>:</p>
<pre><code language="language-kotlin" class="language-kotlin">class EditTask : ActivityResultContract&lt;Task, Task&gt;() {
    override fun createIntent(...)
    override fun parseResult(...)
}
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Partager" duration="0">
        <ul>
<li>En modifiant <code>AndroidManifest.xml</code>, ajouter la possibilit√© de partager du texte <strong>depuis les autres applications</strong> (par ex en surlignant un texte dans un navigateur puis en cliquant sur &#34;partager&#34;) et ouvrir le formulaire de cr√©ation de t√¢che avec une description pr√©-remplie (<a href="https://developer.android.com/training/sharing/receive" target="_blank">Documentation</a>)</li>
<li>En utilisant un <code>Intent</code> <strong>implicite</strong>, ajouter la possibilit√© de partager du texte <strong>vers les autres applications</strong> (avec un <code>OnLongClickListener</code> sur les t√¢ches par ex ou bien avec un bouton dans la vue formulaire) (<a href="https://developer.android.com/training/sharing/send" target="_blank">Documentation</a>)</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Changements de configuration" duration="0">
        <p>Que se passe-t-il si vous tournez votre t√©l√©phone pour passer l&#39;app en mode paysage ? ü§î</p>
<ul>
<li>Une fa√ßon de r√©gler ce soucis est d&#39;overrider la m√©thode suivante:</li>
</ul>
<pre><code language="language-kotlin" class="language-kotlin">override fun onSaveInstanceState(outState: Bundle)
</code></pre>
<ul>
<li>Il faudra utiliser <code>putParcelableArrayList</code></li>
<li>Il faudra aussi que votre classe <code>Task</code> h√©rite de <code>Parcelable</code>: pour impl√©menter <a href="https://developer.android.com/kotlin/parcelize" target="_blank">automatiquement</a> les m√©thodes n√©cessaires, ajoutez le plugin <code>kotlin-parcelize</code> √† votre <code>app/build.gradle</code> et l&#39;annotation <code>@Parcelize</code> √† votre classe <code>Task</code></li>
<li>Puis, pour r√©cup√©rer cette liste, utilisez l&#39;argument <code>savedInstanceState</code> et la m√©thode <code>getParcelableArrayList</code> dans <code>onCreateView</code></li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Interface et d√©l√©gation" duration="0">
        <p>Une fa√ßon plus classique de g√©rer les clicks d&#39;un item est de d√©finir une interface que l&#39;on impl√©mentera dans l&#39;Activity/Fragment. Mettez √† jour votre code pour utiliser cette m√©thode:</p>
<pre><code language="language-kotlin" class="language-kotlin">interface TaskListListener {
  fun onClickDelete(task: Task)
}

class TaskListAdapter(val listener: TaskListListener) : ... {
  // use: listener.onClickDelete(task)
}

class TaskListFragment : Fragment {
  val adapterListener = object : TaskListListener {
    override onClickDelete(task: Task) {...}
  }
  val adapter = TaskListAdapter(adapterListener)
}
</code></pre>
<p>Prenez exemple sur ceci pour remplacer vos lambdas.</p>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
