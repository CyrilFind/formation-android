
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>TP 1 - RecyclerView</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="TP1"
                  title="TP 1 - RecyclerView"
                  environment="web"
                  feedback-link="">
    
      <google-codelab-step label="Objectif" duration="0">
        <p>impl√©menter un √©cran affichant une liste de t√¢ches et permettre de cr√©er des nouvelles t√¢ches.</p>
<aside class="warning"><p>‚ö†Ô∏è Lisez toutes les questions: souvent vous bloquez simplement parce que vous n&#39;avez pas encore regard√© l&#39;√©tape suivante ou le sujet dans son ensemble.</p>
</aside>
<p>üöÄ Aidez vous de l&#39;IDE: Android Studio fait beaucoup de travail pour vous donc utilisez l&#39;autocompletion et les raccourcis:</p>
<ul>
<li><code>Ctrl</code> ou <code>Cmd</code> + <code>click</code> pour voir les usages ou la d√©finition d&#39;un √©l√©ment</li>
<li><code>Alt</code> + <code>Enter</code> pour des &#34;üí° QuickFix&#34;</li>
<li><code>Shift, Shift + "recherche"</code> pour tout le reste (rechercher une variable, fonction, classe, actions, options, ...)</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Cr√©er un projet" duration="0">
        <p>Vous allez cr√©er un unique projet &#34;fil rouge&#34; que vous mettrez √† jour au fur √† mesure des TPs:</p>
<ul>
<li>Utilisez l&#39;IDE pour cr√©er un projet <code>Empty Activity</code></li>
<li>Donnez lui un nom personnalis√© comme <code>ToDoNicolasAlexandre</code> (‚ö†Ô∏è pas <code>TP1</code> SVP ‚ö†Ô∏è)</li>
<li>Choisissez un package name (ex: <code>com.nicoalex.todo</code>)</li>
<li>Language <code>Kotlin</code></li>
<li>Minimum API Level: API 23, Android 6.0 (Marshmallow)</li>
<li>Initialisez un projet git et faites un commit initial</li>
<li>Committez r√©guli√®rement: √† chaque fois que vous avez quelque chose qui compile et qui fonctionne.</li>
<li>Faites au minimum un commit √† la fin de chaque TP</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Ajout de D√©pendances" duration="0">
        <p>Dans <code>./build.gradle</code> (celui du <em>projet</em>), v√©rifiez que <code>kotlin_version</code> est r√©cent (ex: <code>1.5.31</code>)</p>
<p>Dans <code>app/build.gradle</code> (celui du <em>module </em><code>app</code>), ajouter les libs suivante dans <code>dependencies{}</code>:</p>
<pre><code language="language-groovy" class="language-groovy">implementation &#34;androidx.recyclerview:recyclerview:1.2.1&#34;
implementation &#39;androidx.fragment:fragment-ktx:1.4.0&#39;
implementation &#39;androidx.activity:activity-ktx:1.4.0&#39;
</code></pre>
<p>V√©rifiez que le block <code>android{}</code> ressemble √† ceci:</p>
<pre><code language="language-groovy" class="language-groovy">android {
    compileSdkVersion 31
    defaultConfig {
        applicationId &#34;com.nicoalex.kodo&#34;
        minSdkVersion 23
        targetSdkVersion 31
        // ...
    }

    // ...
    compileOptions {
        sourceCompatibility = 1.8
        targetCompatibility = 1.8
    }

    kotlinOptions {
        jvmTarget = &#34;1.8&#34;
    }
  }
}
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Gestion des fichiers" duration="0">
        <p>Les fichiers source Java ou Kotlin sont rang√©s en &#34;packages&#34; (not√© en haut de chaque classe: <code>package com.nicoalex.todo.nomdupackage</code>) qui sont aussi r√©pliqu√©s en tant que dossiers dans le filesystem</p>
<p>Dans le volet &#34;Projet&#34; (√† gauche d&#39;Android Studio), vous pouvez choisir diverses visualisations de vos fichiers: la plus adapt√©e pour nous est &#34;Android&#34;, mais il peut parfois √™tre pratique de passer en &#34;Project Files&#34; par ex pour voir l&#39;arborescence r√©elle.</p>
<p>Cr√©ez un nouveau package <code>tasklist</code> dans votre package source de base:</p>
<p><code>app > java > com.nicoalex.todo > clic droit > New > package > "tasklist"</code></p>
<p>Vous y mettrez tous les fichiers source (Kotlin) concernant la liste de t√¢ches</p>


      </google-codelab-step>
    
      <google-codelab-step label="MainActivity" duration="0">
        <p>Cette activity va servir de conteneur de fragments:</p>
<p>Dans <code>activity_main.xml</code>, remplacez la balise <code>TextView</code> par celle ci (√† adapter):</p>
<pre><code language="language-xml" class="language-xml"> &lt;androidx.fragment.app.FragmentContainerView
    android:name=&#34;com.nicoalex.todo.TaskListFragment&#34;
    android:id=&#34;@+id/fragment_tasklist&#34;
    android:layout_width=&#34;match_parent&#34;
    android:layout_height=&#34;match_parent&#34;
    /&gt;
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="TaskListFragment" duration="0">
        <ul>
<li>Cr√©ez dans votre nouveau package <code>tasklist</code> un fichier kotlin <code>TaskListFragment.kt</code> qui contiendra la classe <code>TaskListFragment</code>:</li>
</ul>
<pre><code language="language-kotlin" class="language-kotlin">class TaskListFragment : Fragment() {}
</code></pre>
<ul>
<li>Cr√©er le layout associ√© <code>fragment_task_list.xml</code> dans <code>res/layout</code></li>
</ul>
<aside class="special"><p>vous pouvez aussi utiliser l&#39;IDE pour cr√©er les 2 fichiers √† la fois: <code>Clic droit sur le package > New > Fragment > Fragment (Blank)</code></p>
</aside>
<ul>
<li>Dans <code>TaskListFragment</code>, overrider la m√©thode <code>onCreateView(...)</code>: commencez √† taper <code>onCrea...</code> et utilisez l&#39;auto-completion de l&#39;IDE pour vous aider (vous pouvez supprimer la ligne <code>super.onCreateView(...)</code>)</li>
<li>Cette m√©thode vous demande de <em>retourner</em> la <code>rootView</code> √† afficher: cr√©ez la √† l&#39;aide de votre nouveau layout comme ceci:</li>
</ul>
<pre><code language="language-kotlin" class="language-kotlin">val rootView = inflater.inflate(R.layout.fragment_task_list, container, false)
</code></pre>
<aside class="warning"><p> ‚ö†Ô∏è Si vous ex√©cutez du code *avant* cette ligne `inflate`, il va crasher ou ne rien faire car votre vue n&#39;existera pas encore </p>
</aside>
<ul>
<li>Pour commencer, la liste des t√¢ches sera simplement une liste de <code>String</code> que vous pouvez ajouter en propri√©t√© de votre classe <code>TaskListFragment</code>:</li>
</ul>
<pre><code language="language-kotlin" class="language-kotlin">private val taskList = listOf(&#34;Task 1&#34;, &#34;Task 2&#34;, &#34;Task 3&#34;)
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="RecyclerView et Adapter" duration="0">
        <ul>
<li>Dans le layout associ√© √† <code>TaskListFragment</code>, placez une balise <code>RecyclerView</code> (vous pouvez taper <code>< Recyc...></code> et vous aider de l&#39;IDE ou bien utilisez le mode visuel):</li>
<li>Dans un nouveau fichier <code>TaskListAdapter.kt</code>, cr√©ez 2 nouvelles classes: <code>TaskListAdapter</code> et <code>TaskViewHolder</code>:</li>
</ul>
<pre><code language="language-kotlin" class="language-kotlin">// l&#39;IDE va r√¢ler ici car on a pas encore impl√©ment√© les m√©thodes n√©cessaires
class TaskListAdapter) : RecyclerView.Adapter&lt;TaskListAdapter.TaskViewHolder&gt;() {

  var taskList: List&lt;String&gt;

  // on utilise `inner` ici afin d&#39;avoir acc√®s aux propri√©t√©s de l&#39;adapter directement
  inner class TaskViewHolder(itemView: View) : RecyclerView.ViewHolder(itemView) {
    fun bind(taskTitle: String) {
      // on affichera les donn√©es ici
    }
  }
}

</code></pre>
<ul>
<li>Dans <code>TaskListFragment</code>, overridez <code>onViewCreated</code> pour y r√©cup√©rer la <code>RecyclerView</code> du layout en utilisant un <code>findViewById</code>:</li>
</ul>
<pre><code language="language-kotlin" class="language-kotlin">    val recyclerView = view.findViewById&lt;RecyclerView&gt;(R.id.id_de_votre_recycler_view)
    recyclerView.layoutManager = ...
</code></pre>
<ul>
<li>Donnez lui un <code>layoutManager</code>: <code>LinearLayoutManager(context)</code></li>
<li>cr√©ez un <code>adapter</code> et passez lui la liste actuelle:</li>
</ul>
<pre><code language="language-kotlin" class="language-kotlin">val adapter = TaskListAdapter() // ne marche pas pour l&#39;instant
adapter.tasklist = taskList
</code></pre>
<ul>
<li>assignez cet adapter √† votre recyclerView</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Item View" duration="0">
        <ul>
<li>Cr√©er le layout <code>item_task.xml</code> correspondant √† une cellule (et donc li√© √† <code>TaskViewHolder</code>)</li>
</ul>
<pre><code language="language-xml" class="language-xml">&lt;LinearLayout
  xmlns:android=&#34;http://schemas.android.com/apk/res/android&#34;
  android:orientation=&#34;vertical&#34;
  android:layout_width=&#34;match_parent&#34;
  android:layout_height=&#34;wrap_content&#34;&gt;

  &lt;TextView
      android:id=&#34;@+id/task_title&#34;
      android:background=&#34;@android:color/holo_blue_bright&#34;
      android:layout_width=&#34;match_parent&#34;
      android:layout_height=&#34;wrap_content&#34; /&gt;
&lt;/LinearLayout&gt;
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Impl√©mentation du RecyclerViewAdapter" duration="0">
        <aside class="special"><p><strong>Rappel</strong>: l&#39;Adapter g√®re le recyclage des cellules (<code>ViewHolder</code>): il en <code>inflate</code> juste assez pour remplir l&#39;√©cran (co√ªteux) puis change seulement les donn√©es quand on scroll (peu co√ªteux)</p>
</aside>
<p>Dans le <code>TaskListAdapter</code>, impl√©menter toutes les m√©thodes requises:</p>
<p><strong>Astuce</strong>: Pr√©-remplissez votre adapter en cliquant sur le nom de votre classe (qui doit √™tre pour l&#39;instant soulign√©e en rouge) et cliquez sur l&#39;ampoule jaune ou tapez <code>Alt</code> + <code>ENTER</code> (sinon, <code>CTRL</code> + <code>O</code> n&#39;importe o√π dans la classe)</p>
<ul>
<li><code>getItemCount</code> doit renvoyer la taille de la liste de t√¢che √† afficher</li>
<li><code>onCreateViewHolder</code> doit retourner un nouveau <code>TaskViewHolder</code> en g√©n√©rant un <code>itemView</code>, √† partir du layout <code>item_task.xml</code>:</li>
</ul>
<pre><code language="language-kotlin" class="language-kotlin">val itemView = LayoutInflater.from(parent.context).inflate(R.layout.item_task, parent, false)
</code></pre>
<ul>
<li><code>onBindViewHolder</code> doit ins√©rer la donn√©e dans la cellule (<code>TaskViewHolder</code>) en fonction de sa <code>position</code> dans la liste en utilisant la m√©thode <code>bind()</code> que vous avez cr√©√©e dans <code>TaskViewHolder</code> (elle ne fait rien pour l&#39;instant)</li>
<li>Impl√©mentez maintenant <code>bind()</code> qui doit r√©cup√©rer une r√©f√©rence √† la <code>TextView</code> dans <code>item_task.xml</code> et y ins√©rer le texte r√©cup√©r√© en argument</li>
<li>Lancez l&#39;app: vous devez voir 3 t√¢ches s&#39;afficher üëè</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Ajout de la data class Task" duration="0">
        <ul>
<li>Dans un nouveau fichier, cr√©er une <code>data class Task</code> avec 3 attributs: un id, un titre et une description</li>
<li>Ajouter une valeur par d√©faut √† la description.</li>
<li>Dans le <code>TaskListFragment</code>, remplacer la liste <code>taskList</code> par</li>
</ul>
<pre><code language="language-kotlin" class="language-kotlin">private var taskList = listOf(
   Task(id = &#34;id_1&#34;, title = &#34;Task 1&#34;, description = &#34;description 1&#34;),
   Task(id = &#34;id_2&#34;, title = &#34;Task 2&#34;),
   Task(id = &#34;id_3&#34;, title = &#34;Task 3&#34;)
)
</code></pre>
<ul>
<li>Corriger et adapter votre code en cons√©quence afin qu&#39;il compile de nouveau en utilisant votre <code>data class</code> √† la place de simples <code>String</code></li>
<li>Ajoutez la description en dessous du titre (avec une seconde <code>TextView</code>)</li>
<li>Admirez avec fiert√© le travail accompli ü§©</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Ajout du FAB" duration="0">
        <ul>
<li>Changez la root view de <code>fragment_task_list.xml</code> en ConstraintLayout en faisant un clic droit dessus en mode design</li>
<li>Ouvrez le volet &#34;Resource Manager&#34; √† gauche, cliquez sur le &#34;+&#34; en haut √† gauche puis &#34;Vector Asset&#34; puis double cliquez sur le clipart du logo android et trouvez une icone &#34;+&#34; (en tapant &#34;add&#34;) puis &#34;finish&#34; pour ajouter une icone √† vos resource</li>
<li>Ajouter un Floating Action Button (FAB) en bas √† droite de ce layout et utilisez l&#39;icone cr√©√©e</li>
<li>Par d√©faut l&#39;ic√¥ne est noire mais vous pourrez utiliser l&#39;attribut <code>app:tint</code> du bouton pour la rendre blanche (tapez &#34;white&#34; et laissez l&#39;IDE compl√©ter)</li>
<li>Donnez des contraintes en bas et √† droite de ce bouton</li>
</ul>
<aside class="special"><p>Vous pouvez configurer les contraintes √† la main ou les faire deviner √† l&#39;IDE:</p>
<ul>
<li>quand vous d√©placez le bouton (attendez de voir appara√Ætre des lignes pointill√©es) avec l&#39;ic√¥ne &#34;Aimant üß≤&#34; activ√©e.</li>
<li>en fonction du placement actuel de vos vues dans l&#39;outil visuel en cliquant sur l&#39;ic√¥ne &#34;baguette magique ü™Ñ&#34;.</li>
</ul>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="Ajout de t√¢che rapide" duration="0">
        <p>Utilisez <code>.setOnClickListener {}</code> sur le FAB pour ajouter une t√¢che √† votre liste:</p>
<pre><code language="language-kotlin" class="language-kotlin">// Instanciation d&#39;un objet task avec des donn√©es pr√©remplies:
val newTask = Task(id = UUID.randomUUID().toString(), title = &#34;Task ${taskList.size + 1}&#34;)
taskList = taskList + newTask
</code></pre>
<aside class="warning"><p>‚ö†Ô∏è pour que votre modification s&#39;affiche, il faut passer la nouvelle liste √† votre adapter puis le <a href="https://developer.android.com/reference/androidx/recyclerview/widget/RecyclerView.Adapter#notifyDataSetChanged()" target="_blank"><strong>notifier</strong></a> de cette nouvelle donn√©e. Ce n&#39;est pas id√©al: on devrait plut√¥t utiliser un <code>ListAdapter</code>, c&#39;est l&#39;√©tape suivante</p>
</aside>


      </google-codelab-step>
    
      <google-codelab-step label="ListAdapter" duration="0">
        <p>Am√©liorer l&#39;impl√©mentation de <code>TasksListAdapter</code> en h√©ritant de <a href="https://developer.android.com/reference/androidx/recyclerview/widget/ListAdapter" target="_blank"><code>ListAdapter</code></a> au lieu de <code>RecyclerView.Adapter</code></p>
<p>Il faudra notamment: cr√©er un <code>DiffUtil.ItemCallback<Task></code> et le passer au constructeur parent, supprimer la propri√©t√© <code>taskList</code> et utiliser <code>getItem(position)</code> √† la place, et vous pourrez supprimer <code>getItemCount</code> qui sera d√©j√† impl√©ment√©e pour vous</p>
<p>Exemple:</p>
<pre><code language="language-kotlin" class="language-kotlin">object WordsDiffCallback : DiffUtil.ItemCallback&lt;Word&gt;() {
   override fun areItemsTheSame(oldItem: Word, newItem: Word) =
      // are they the same &#34;entity&#34; ? (usually same id)
   override fun areContentsTheSame(oldItem: Word, newItem: Word) =
      // do they have the same data ? (content)
}

class WordListAdapter : ListAdapter&lt;Word, WordListAdapter.WordViewHolder&gt;(WordsDiffCallback) {
   override fun onCreateViewHolder(...)
   override fun onBindViewHolder(...)  // use `getItem`
}

// Usage is simpler:
val myAdapter = WordListAdapter()
recyclerView.adapter = myAdapter
myAdapter.submitList(listOf(&#34;word#1&#34;, &#34;word #2&#34;))
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="ViewBinding" duration="0">
        <p>Utiliser le <a href="https://developer.android.com/topic/libraries/view-binding" target="_blank"><code>ViewBinding</code></a> pour <code>inflate</code> les diff√©rents layouts et supprimer les <code>findViewByIds</code> (cf <a href="../slides/2%20-%20UI.html#9" target="_blank">slides</a> pour un squelette d&#39;impl√©mentation)</p>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            document.getElementById("arrow-back").href="/formation-android/codelabs/";
            document.getElementById("done").href="/formation-android/codelabs/";
        }, false);
    </script>

    