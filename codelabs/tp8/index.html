
<!doctype html>

<html>
<head>
  <meta name="viewport" content="width=device-width, minimum-scale=1.0, initial-scale=1.0, user-scalable=yes">
  <meta name="theme-color" content="#4F7DC9">
  <meta charset="UTF-8">
  <title>TP 8: Autonomie</title>
  <link rel="stylesheet" href="//fonts.googleapis.com/css?family=Source+Code+Pro:400|Roboto:400,300,400italic,500,700|Roboto+Mono">
  <link rel="stylesheet" href="//fonts.googleapis.com/icon?family=Material+Icons">
  <link rel="stylesheet" href="https://storage.googleapis.com/codelab-elements/codelab-elements.css">
  <style>
    .success {
      color: #1e8e3e;
    }
    .error {
      color: red;
    }
  </style>
</head>
<body>
  <google-codelab-analytics gaid="UA-49880327-14"></google-codelab-analytics>
  <google-codelab codelab-gaid=""
                  id="tp8"
                  title="TP 8: Autonomie"
                  environment="web"
                  feedback-link="">
    
      <google-codelab-step label="But" duration="0">
        <p>R√©utiliser ce que vous avez appris en TP pour vous l&#39;approprier.</p>


      </google-codelab-step>
    
      <google-codelab-step label="Sujet" duration="0">
        <p>Cr√©er une app &#34;Pok√©dex&#34;, avec les fonctionnalit√©s suivantes:</p>
<ul>
<li>Afficher une grille pagin√©e de pok√©mons avec leurs infos de base: images, noms, num√©ro, type 1, type 2</li>
<li>Afficher le d√©tail d&#39;un pok√©mon avec les autres infos: poids, description, ... (pas oblig√© de tout mettre)</li>
<li>Permettre de &#34;cocher&#34; les pok√©mons que l&#39;on a d√©j√† attrap√©s en enregistrant l&#39;info localement</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Documentation" duration="0">
        <ul>
<li><a href="https://pokeapi.co/" target="_blank">Pok√© API</a>, exemples: <ul>
<li><code>GET https://pokeapi.co/api/v2/pokemon-species</code></li>
<li><code>GET https://pokeapi.coapi/v2/pokemon-species/27</code></li>
</ul>
</li>
<li><a href="https://developer.android.com/topic/libraries/architecture/paging" target="_blank">Paging Library</a></li>
<li><a href="https://developer.android.com/topic/libraries/architecture/room" target="_blank">Room Database</a></li>
<li>Les slides et TPs pr√©c√©dents</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Instructions" duration="0">
        <ul>
<li>Nommez le projet et le package en fonction de votre binome (cf <a href="./TP1.md" target="_blank">TP 1</a>)</li>
<li>Utilisez git tout de suite et commitez r√©guli√®rement pour pouvoir toujours revenir √† une version qui marche ;) (cf <a href="./TP1.md" target="_blank">TP 1</a>)</li>
<li>Essayez de coder &#34;proprement&#34; (pour la syntaxe: <code>cmd + alt + L</code>)</li>
<li>Vous pouvez vous mettre par 2 (mais ne vous faites trop carry !)</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="√âtapes pour l&#39;appli de base" duration="0">
        <ul>
<li>Commencez par une liste lin√©aire moche avec juste les noms et seulement la premi√®re page de l&#39;API</li>
<li>Changez en grille avec une m√™me image par d√©faut pour toutes les cellules (une pok√©ball par ex)</li>
<li>Ajoutez la vue d√©tail: vous devrez faire une requ√™te pour chaque esp√®ce</li>
<li>Afficher les bonnes images dans la liste (en observant le format de l&#39;url dans la r√©ponse de la requ√™te de d√©tails)</li>
<li>Afficher les infos de base dans la liste: un peu compliqu√© car on est oblig√©s de faire une requ√™te pour chaque esp√®ce (ce qui est lourd dans une liste mais am√©liorable plus tard)</li>
<li>Vous pouvez utilisez les <code>ViewModel</code> partag√©s (<code>by activityViewModel</code>) pour √©viter de multiplier certaines requ√™te HTTP</li>
<li>Essayez de faire quelque chose de joli cette fois: <a href="https://www.instagram.com/p/Bx86mp2hWT-/" target="_blank">Un exemple pour vous inspirer</a></li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="Ajouter la pagination" duration="0">
        <ul>
<li>Commencez par utiliser <a href="https://developer.android.com/reference/androidx/recyclerview/widget/ListAdapter" target="_blank"><code>ListAdapter</code></a> √† la place de <code>RecyclerView.Adapter</code>: vous devrez impl√©menter un <code>ListAdapter.DiffCallback</code> mais cela simplifie certaines choses que l&#39;on faisait √† la main: pas besoin de <code>notify*Changed</code>, pas besoin de sp√©cifier le nombre d&#39;items, la liste des donn√©es est stock√©e dans la variable <code>currentList</code> et on utilise <code>adapter.submitList(newList)</code> pour setter les donn√©es</li>
<li>Ajoutez la pagination en passant votre <code>ListAdapter</code> en <code>PagedListAdapter</code></li>
<li>Vous devez maintenant lui passer une <a href="https://developer.android.com/topic/libraries/architecture/paging/ui" target="_blank">PagedList</a>: on va utiliser les LiveData donc on va construire cette liste avec <code>LivePagedListBuilder</code>:</li>
</ul>
<pre><code language="language-kotlin" class="language-kotlin">class MyViewModel : ViewModel() {
    val pagedList = LivePagedListBuilder(object : DataSource.Factory&lt;String, Pokemon&gt;() {
        override fun create(): DataSource&lt;Int, Pokemon&gt; = PokemonPageKeyedDataSource(viewModelScope)
    }, PER_PAGE).build()

    companion object {
        private const val PER_PAGE = 20
    }
}

// on pourra faire presque comme d&#39;habitude dans le fragment ou l&#39;activity:
viewModel.pagedList.observe(viewLifecycleOwner, Observer {
    pokemonListAdapter.submitList(it)
})
</code></pre>
<ul>
<li>Mais pour que cela fonctionne on a besoin de cr√©er <code>PokemonPageKeyedDataSource</code>:</li>
</ul>
<pre><code language="language-kotlin" class="language-kotlin">class PokemonPageKeyedDataSource(private val scope: CoroutineScope) : PageKeyedDataSource&lt;Int, Pokemon&gt;() {

    override fun loadBefore(
        params: LoadParams&lt;Int&gt;,
        callback: LoadCallback&lt;Int, Pokemon&gt;
    ) {
        // on ne fait rien ici car on commence au 1er pok√©mon et il n&#39;y a rien avant
        // (ce serait utile pour un feed √† la twitter ou facebook)
    }

    override fun loadInitial(
        params: LoadInitialParams&lt;Int&gt;,
        callback: LoadInitialCallback&lt;Int, Pokemon&gt;
    ) {
        // Charger la page 0, utiliser la callback avec la valeur 1 comme &#34;key&#34;
    }

    override fun loadAfter(params: LoadParams&lt;Int&gt;, callback: LoadCallback&lt;Int, Pokemon&gt;) {
        val currentPage = params.key
       // utiliser la valeur de &#34;key&#34; pour requ√™ter la page &#34;currentPage&#34; et utiliser la callback avec currentPage + 1
     }
}
</code></pre>
<ul>
<li>Pour pouvoir faire des requ√™tes avec des pages, il faut utiliser les &#34;query parameters&#34; permis par l&#39;api:</li>
</ul>
<pre><code language="language-kotlin" class="language-kotlin">interface PokemonWebService {
    @GET(&#34;pokemon&#34;)
    suspend fun getPokemons(@Query(&#34;limit&#34;) limit: Int, @Query(&#34;offset&#34;) offset: Int = 0): Response&lt;PokeListResponse&gt;
}

// on pourra l&#39;utiliser comme ceci:
val currentPage = params.key
val itemsPerPage = params.requestedLoadSize
pokemonWebService.getPokemons(
    limit = itemsPerPage,
    offset = currentPage * itemsPerPage
)
</code></pre>


      </google-codelab-step>
    
      <google-codelab-step label="Aller plus loin" duration="0">
        <ul>
<li>Stocker les r√©ponses des requ√™tes pour ne pas les refaire tout le temps, sachant que les donn√©e ne changent pas souvent: <ul>
<li>soit en RAM c&#39;est √† dire dans une variable de type <code>Map<Int, Pokemon></code> dans un repository par ex, (plus simple)</li>
<li>soit dans une BD locale <a href="https://developer.android.com/topic/libraries/architecture/room" target="_blank">Room</a> (plus compliqu√© mais de meilleur qualit√© car la donn√©e survie au kill de l&#39;app)</li>
</ul>
</li>
<li>Ajoutez la possibilit√© de &#34;cocher&#34; les esp√®ces attrap√©es (vous pouvez dans l&#39;ordre de de difficult√© et de qualit√©: en RAM, dans les SharedPreference, ou dans Room)</li>
<li>la plupart des am√©liorations des <a href="./sujets_explo.md" target="_blank">sujets exploratoires</a> peuvent aussi s&#39;appliquer</li>
<li>Ajoutez des fonctionnalit√©s si vous avez des id√©es, par ex: <ul>
<li>Une barre de recherche</li>
<li>Un filtre par g√©n√©ration</li>
<li>...</li>
</ul>
</li>
</ul>


      </google-codelab-step>
    
      <google-codelab-step label="√âvaluation" duration="0">
        <p>Le projet devra √™tre rendu sous forme de lien git de pr√©f√©rence (un zip sinon), au plus tard √† 23h59 le 13 Juin</p>
<p>Voici un bar√™me indicatif:</p>
<ul>
<li>Fonctionnement de base: afficher une liste non pagin√©e (pas trop moche) / 5</li>
<li>Afficher une grille et une vue d√©tail (pas trop moche) / 5</li>
<li>Respecter la structure MVVM + repository / 5</li>
<li>Pagination, optimisation des requ√™tes, autres features / 5</li>
<li>bonus: pour ceux qui ont commenc√© le projet de leur c√¥t√© / 5</li>
<li>bonus: si vous arrivez √† utiliser Room ou d&#39;autres features avanc√©es / 5</li>
</ul>
<p>Vous pouvez donc avoir plus que 20 ce qui am√©liorera votre moyenne (sauf si vous avez d√©j√† 20 üòÖ)</p>


      </google-codelab-step>
    
  </google-codelab>

  <script src="https://storage.googleapis.com/codelab-elements/native-shim.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/custom-elements.min.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/prettify.js"></script>
  <script src="https://storage.googleapis.com/codelab-elements/codelab-elements.js"></script>
  <script src="//support.google.com/inapp/api.js"></script>

</body>
</html>
